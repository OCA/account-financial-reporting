<?xml version="1.0" encoding="utf-8" ?>
<!-- Copyright 2019 ADHOC SA
     License AGPL-3.0 or later (https://www.gnu.org/licenses/agpl). -->
<odoo noupdate="True">
    <record id="mis_report_cash_flow" model="mis.report">
        <field name="name">Cash Flow</field>
        <field name="style_id" ref="mis_style_cash_flow" />
    </record>
    <record id="mis_kpi_in_total" model="mis.report.kpi">
        <field name="report_id" ref="mis_report_cash_flow" />
        <field name="name">in_total</field>
        <field name="description">IN TOTAL</field>
        <field name="style_id" ref="mis_style_account_sub_total" />
        <field name="sequence">30</field>
        <field
            name="expression"
        >in_liquidity + in_receivable + in_payable + in_remaining_forecast</field>
    </record>
    <record id="mis_kpi_in_liquidity" model="mis.report.kpi">
        <field name="report_id" ref="mis_report_cash_flow" />
        <field name="name">in_liquidity</field>
        <field name="description">In Liquidity</field>
        <field name="style_id" ref="mis_style_account_line" />
        <field name="auto_expand_accounts" eval="True" />
        <field name="auto_expand_accounts_style_id" ref="mis_style_account_detail" />
        <field name="sequence">40</field>
        <field
            name="expression"
        >bal[][('account_internal_type', '=', 'liquidity'), ('debit', '!=', 0.0), ('line_type', '=', 'move_line'), ('account_id.hide_in_cash_flow', '=', False)]</field>
    </record>
    <record id="mis_kpi_in_receivable" model="mis.report.kpi">
        <field name="report_id" ref="mis_report_cash_flow" />
        <field name="name">in_receivable</field>
        <field name="description">In receivable</field>
        <field name="style_id" ref="mis_style_account_line" />
        <field name="auto_expand_accounts" eval="True" />
        <field name="auto_expand_accounts_style_id" ref="mis_style_account_detail" />
        <field name="sequence">50</field>
        <field
            name="expression"
        >bal[][('account_internal_type', '=', 'receivable'), ('debit', '!=', 0.0), ('full_reconcile_id', '=', False), ('line_type', '=', 'move_line'), ('account_id.hide_in_cash_flow', '=', False)]</field>
    </record>
    <record id="mis_kpi_in_payable" model="mis.report.kpi">
        <field name="report_id" ref="mis_report_cash_flow" />
        <field name="name">in_payable</field>
        <field name="description">In payable</field>
        <field name="style_id" ref="mis_style_account_line" />
        <field name="auto_expand_accounts" eval="True" />
        <field name="auto_expand_accounts_style_id" ref="mis_style_account_detail" />
        <field name="sequence">60</field>
        <field
            name="expression"
        >bal[][('account_internal_type', '=', 'payable'), ('debit', '!=', 0.0), ('full_reconcile_id', '=', False), ('line_type', '=', 'move_line'), ('account_id.hide_in_cash_flow', '=', False)]</field>
    </record>
    <record id="mis_kpi_in_remaining_forecast" model="mis.report.kpi">
        <field name="report_id" ref="mis_report_cash_flow" />
        <field name="name">in_remaining_forecast</field>
        <field name="description">In forecast (remaining)</field>
        <field name="style_id" ref="mis_style_account_line" />
        <field name="auto_expand_accounts" eval="True" />
        <field name="auto_expand_accounts_style_id" ref="mis_style_account_detail" />
        <field name="sequence">70</field>
        <field name="expression">
            max(bal[][('line_type', '=', 'forecast_line'), ('debit', '!=', 0.0), ('account_id.hide_in_cash_flow', '=', False)]
            -bal[][('account_internal_type', 'in', ('receivable', 'payable')), ('debit', '!=', 0.0), ('full_reconcile_id', '=', False), ('line_type', '=', 'move_line'), ('account_id.hide_in_cash_flow', '=', False)]
            -bal[][('account_internal_type', '=', 'liquidity'), ('debit', '!=', 0.0), ('line_type', '=', 'move_line'), ('account_id.hide_in_cash_flow', '=', False)], 0.0)
        </field>
    </record>
    <record id="mis_kpi_out_total" model="mis.report.kpi">
        <field name="report_id" ref="mis_report_cash_flow" />
        <field name="name">out_total</field>
        <field name="description">OUT TOTAL</field>
        <field name="style_id" ref="mis_style_account_sub_total" />
        <field name="sequence">80</field>
        <field
            name="expression"
        >out_liquidity + out_payable + out_receivable + out_remaining_forecast</field>
    </record>
    <record id="mis_kpi_out_liquidity" model="mis.report.kpi">
        <field name="report_id" ref="mis_report_cash_flow" />
        <field name="name">out_liquidity</field>
        <field name="description">Out Liquidity</field>
        <field name="style_id" ref="mis_style_account_line" />
        <field name="auto_expand_accounts" eval="True" />
        <field name="auto_expand_accounts_style_id" ref="mis_style_account_detail" />
        <field name="sequence">90</field>
        <field
            name="expression"
        >bal[][('account_internal_type', '=', 'liquidity'), ('credit', '!=', 0.0), ('line_type', '=', 'move_line'), ('account_id.hide_in_cash_flow', '=', False)]</field>
    </record>
    <record id="mis_kpi_out_payable" model="mis.report.kpi">
        <field name="report_id" ref="mis_report_cash_flow" />
        <field name="name">out_payable</field>
        <field name="description">Out payable</field>
        <field name="style_id" ref="mis_style_account_line" />
        <field name="auto_expand_accounts" eval="True" />
        <field name="auto_expand_accounts_style_id" ref="mis_style_account_detail" />
        <field name="sequence">100</field>
        <field
            name="expression"
        >bal[][('account_internal_type', '=', 'payable'), ('credit', '!=', 0.0), ('full_reconcile_id', '=', False), ('line_type', '=', 'move_line'), ('account_id.hide_in_cash_flow', '=', False)]</field>
    </record>
    <record id="mis_kpi_out_receivable" model="mis.report.kpi">
        <field name="report_id" ref="mis_report_cash_flow" />
        <field name="name">out_receivable</field>
        <field name="description">Out receivable</field>
        <field name="style_id" ref="mis_style_account_line" />
        <field name="auto_expand_accounts" eval="True" />
        <field name="auto_expand_accounts_style_id" ref="mis_style_account_detail" />
        <field name="sequence">110</field>
        <field
            name="expression"
        >bal[][('account_internal_type', '=', 'receivable'), ('credit', '!=', 0.0), ('full_reconcile_id', '=', False), ('line_type', '=', 'move_line'), ('account_id.hide_in_cash_flow', '=', False)]</field>
    </record>
    <record id="mis_kpi_out_remaining_forecast" model="mis.report.kpi">
        <field name="report_id" ref="mis_report_cash_flow" />
        <field name="name">out_remaining_forecast</field>
        <field name="description">Out forecast (remaining)</field>
        <field name="style_id" ref="mis_style_account_line" />
        <field name="auto_expand_accounts" eval="True" />
        <field name="auto_expand_accounts_style_id" ref="mis_style_account_detail" />
        <field name="sequence">120</field>
        <field name="expression">
            min(bal[][('line_type', '=', 'forecast_line'), ('credit', '!=', 0.0), ('account_id.hide_in_cash_flow', '=', False)]
            -bal[][('account_internal_type', 'in', ('receivable', 'payable')), ('credit', '!=', 0.0), ('full_reconcile_id', '=', False), ('line_type', '=', 'move_line'), ('account_id.hide_in_cash_flow', '=', False)],
            -bal[][('account_internal_type', '=', 'liquidity'), ('credit', '!=', 0.0), ('line_type', '=', 'move_line'), ('account_id.hide_in_cash_flow', '=', False)], 0.0)
        </field>
    </record>
    <record id="mis_kpi_period_balance" model="mis.report.kpi">
        <field name="report_id" ref="mis_report_cash_flow" />
        <field name="name">period_balance</field>
        <field name="description">PERIOD BALANCE</field>
        <field name="style_id" ref="mis_style_account_sub_total" />
        <field name="sequence">130</field>
        <field name="expression">in_total + out_total</field>
        <field
            name="style_expression"
        >'Cash Flow - Good' if period_balance >= 0.0 else 'Cash Flow - Bad'</field>
    </record>
    <record id="mis_kpi_balance" model="mis.report.kpi">
        <field name="report_id" ref="mis_report_cash_flow" />
        <field name="name">balance</field>
        <field name="description">BALANCE</field>
        <field name="style_id" ref="mis_style_account_total" />
        <field name="sequence">150</field>
        <field
            name="expression"
        >bale[][('account_id.hide_in_cash_flow', '=', False), '|', ('line_type', '=', 'forecast_line'), ('line_type', '=', 'move_line'), '|', ('account_internal_type', '=', 'liquidity'), ('account_internal_type', 'in', ('receivable', 'payable')), ('full_reconcile_id', '=', False)]</field>
        <field
            name="style_expression"
        >'Cash Flow - Good' if balance >= 0.0 else 'Cash Flow - Bad'</field>
    </record>
</odoo>
