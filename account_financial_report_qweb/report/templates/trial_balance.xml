<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <template id="account_financial_report_qweb.report_trial_balance_qweb">
        <t t-call="report.html_container">
            <t t-foreach="docs" t-as="o">
                <!-- Saved flag fields into variables, used to define columns display -->
                <t t-set="show_partner_details" t-value="o.show_partner_details"/>
                <t t-set="foreign_currency" t-value="o.foreign_currency"/>
                <t t-call="account_financial_report_qweb.internal_layout">
                    <!-- Defines global variables used by internal layout -->
                    <t t-set="title">Trial Balance</t>
                    <t t-set="company_name" t-value="o.company_id.name"/>

                    <div class="page">
                        <!-- Display filters -->
                        <t t-call="account_financial_report_qweb.report_trial_balance_qweb_filters"/>
                        <div class="act_as_table list_table" style="margin-top: 10px;"/>

                        <!-- Display account lines -->
                        <t t-if="not show_partner_details">
                            <div class="act_as_table data_table" style="width: 1325px !important;">
                                <!-- Display account header -->
                                <t t-call="account_financial_report_qweb.report_trial_balance_qweb_lines_header"/>

                                <!-- Display each lines -->
                                <t t-foreach="o.account_ids" t-as="line">
                                    <t t-set="type" t-value='"account_type"'/>
                                    <!-- Adapt -->
                                    <t t-set="style" t-value="'font-size:8px;'"/>
                                    <t t-set="padding" t-value="line.level * 4"/>
                                    <t t-set="style" t-value="'font-size: ' + str(14 - line.level) + 'px; margin-left: ' + str(line.level * 4) + 'px;'"/>

                                    <!-- Display account lines -->
                                    <t t-call="account_financial_report_qweb.report_trial_balance_qweb_line"/>
                                </t>
                            </div>
                        </t>

                        <!-- Display partner lines -->
                        <t t-if="show_partner_details">
                            <t t-foreach="o.account_ids" t-as="account">
                                <div class="page_break">
                                    <!-- Display account header -->
                                    <div class="act_as_table list_table" style="margin-top: 10px;"/>
                                    <div class="act_as_caption account_title" style="width: 1141px !important;">
                                        <span t-field="account.code"/> - <span t-field="account.name"/>
                                    </div>

                                    <div class="act_as_table data_table" style="width: 1325px !important;">
                                        <!-- Display account/partner header -->
                                        <t t-call="account_financial_report_qweb.report_trial_balance_qweb_lines_header"/>

                                        <!-- Display each partners -->
                                        <t t-foreach="account.partner_ids" t-as="line">
                                            <t t-set="type" t-value='"partner_type"'/>
                                            <!-- Display partner line -->
                                            <t t-call="account_financial_report_qweb.report_trial_balance_qweb_line"/>
                                        </t>
                                    </div>

                                    <!-- Display account footer -->
                                    <t t-set="type" t-value='"account_type"'/>
                                    <t t-call="account_financial_report_qweb.report_trial_balance_qweb_account_footer"/>
                                </div>
                            </t>

                        </t>
                    </div>
                </t>
            </t>
        </t>
    </template>

    <template id="account_financial_report_qweb.report_trial_balance_qweb_filters">
        <div class="act_as_table data_table" style="width: 1325px !important;">
            <div class="act_as_row labels">
                <div class="act_as_cell">Date range filter</div>
                <div class="act_as_cell">Target moves filter</div>
                <div class="act_as_cell">Account balance at 0 filter</div>
            </div>
            <div class="act_as_row">
                <div class="act_as_cell">
                    From: <span t-field="o.date_from"/> To: <span t-field="o.date_to"/>
                </div>
                <div class="act_as_cell">
                    <t t-if="o.only_posted_moves">All posted entries</t>
                    <t t-if="not o.only_posted_moves">All entries</t>
                </div>
                <div class="act_as_cell">
                    <t t-if="o.hide_account_balance_at_0">Hide</t>
                    <t t-if="not o.hide_account_balance_at_0">Show</t>
                </div>
            </div>
        </div>
    </template>

    <template id="account_financial_report_qweb.report_trial_balance_qweb_lines_header">
        <!-- Display table headers for lines -->
        <div class="act_as_thead">
            <div class="act_as_row labels">
                <t t-if="not show_partner_details">
                    <!--## Code-->
                    <div class="act_as_cell" style="width: 100px;">Code</div>
                    <!--## Account-->
                    <div class="act_as_cell" style="width: 600px;">Account</div>
                </t>
                <t t-if="show_partner_details">
                    <!--## Partner-->
                    /<div class="act_as_cell" style="width: 700px;">Partner</div>
                </t>
                <!--## Initial balance-->
                <div class="act_as_cell" style="width: 110px;">Initial balance</div>
                <!--## Debit-->
                <div class="act_as_cell" style="width: 110px;">Debit</div>
                <!--## Credit-->
                <div class="act_as_cell" style="width: 110px;">Credit</div>
                <!--## Ending balance-->
                <div class="act_as_cell" style="width: 110px;">Ending balance</div>
                <!--## currency_name-->
                <div class="act_as_cell" style="width: 35px;">Cur.</div>
                <!--## amount_currency-->
                <div class="act_as_cell" style="width: 75px;">Initial blance cur.</div>
                <div class="act_as_cell" style="width: 75px;">Ending blance cur.</div>
            </div>
        </div>
    </template>

    <template id="account_financial_report_qweb.report_trial_balance_qweb_line">
        <!-- # line -->
        <div class="act_as_row lines">
            <t t-if="not show_partner_details">
                <!--## Code-->
                <div class="act_as_cell left"><span t-field="line.code"/></div>
            </t>
            <!--## Account/Partner-->
            <div class="act_as_cell left"><span t-field="line.name"/></div>
            <!--## Initial balance-->
            <div class="act_as_cell amount"><span t-field="line.initial_balance"/></div>
            <!--## Debit-->
            <div class="act_as_cell amount"><span t-field="line.debit"/></div>
            <!--## Credit-->
            <div class="act_as_cell amount"><span t-field="line.credit"/></div>
            <!--## Ending balance-->
            <div class="act_as_cell amount"><span t-field="line.final_balance"/></div>
            <t t-if="foreign_currency">
                <t t-if="line.currency_id">
            <!--## currency_name-->
                    <div class="act_as_cell">
                        <t t-if="type == 'account_type'">
                            <span t-field="line.currency_id.display_name"/>
                        </t>
                        <t t-if="type == 'partner_type'">
                            <span t-field="line.report_account_id.currency_id.display_name"/>
                        </t>
            </div>
                    <!--## Initial balance cur.-->
                     <div class="act_as_cell amount">
                        <t t-if="type == 'account_type'">
                            <t t-set="domain"
                               t-value="[('account_id', '=', line.account_id.id)]"/>
                            <span>
                                <t t-att-style="style" t-raw="line.initial_balance_foreign_currency" t-options="{'widget': 'monetary', 'display_currency': line.currency_id}"/>
                            </span>
                        </t>
                        <t t-if="type == 'partner_type'">
                            <t t-set="domain"
                               t-value="[('account_id', '=', line.report_account_id.account_id.id),
                                         ('partner_id', '=', line.partner_id.id)]"/>
                            <span>
                                <t t-att-style="style" t-raw="line.initial_balance_foreign_currency" t-options="{'widget': 'monetary', 'display_currency': line.report_account_id.currency_id}"/>
                            </span>
                        </t>
                    </div>
                    <!--## Ending balance cur.-->
                    <div class="act_as_cell amount">
                        <t t-if="type == 'account_type'">
                            <t t-set="domain"
                               t-value="[('account_id', '=', line.account_id.id)]"/>
                            <span>
                                <t t-att-style="style" t-raw="line.final_balance_foreign_currency" t-options="{'widget': 'monetary', 'display_currency': line.currency_id}"/>
                            </span>
                        </t>
                        <t t-if="type == 'partner_type'">
                            <t t-set="domain"
                               t-value="[('account_id', '=', line.report_account_id.account_id.id),
                                         ('partner_id', '=', line.partner_id.id)]"/>
                            <span>
                                <t t-att-style="style" t-raw="line.final_balance_foreign_currency" t-options="{'widget': 'monetary', 'display_currency': line.report_account_id.currency_id}"/>
                            </span>
                        </t>
                    </div>
                </t>
                <t t-if="not line.currency_id.id">
                <!--## balance_currency-->
                <div class="act_as_cell"/>
                <div class="act_as_cell"/>
                <div class="act_as_cell"/>
                </t>
            </t>
        </div>
    </template>

    <template id="account_financial_report_qweb.report_trial_balance_qweb_account_footer">
        <!-- Display account footer -->
        <div class="act_as_table list_table" style="width: 1141px !important;">
            <div class="act_as_row labels" style="font-weight: bold;">
                <!--## Account-->
                <div class="act_as_cell left" style="width: 700px;">
                    <t t-set="res_model" t-value="'account.account'"/>
                    <span>
                        <t t-att-style="style" t-raw="account.code"/> - <t t-att-style="style" t-raw="account.name"/>
                    </span>
                </div>
                <!--## Initial balance-->
                <div class="act_as_cell amount" style="width: 110px;">
                    <t t-set="domain"
                        t-value="[('account_id', '=', account.account_id.id),
                                  ('date', '&lt;', o.date_from)]"/>
                    <span>
                        <t t-att-style="style" t-raw="account.initial_balance" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                    </span>
                </div>
                <!--## Debit-->
                <div class="act_as_cell amount" style="width: 110px;">
                    <t t-set="domain"
                        t-value="[('account_id', '=', account.account_id.id),
                                  ('date', '&gt;=', account.report_id.date_from),
                                  ('date', '&lt;=', account.report_id.date_to),
                                  ('debit', '&lt;&gt;', 0)]"/>
                    <span>
                        <t t-att-style="style" t-raw="account.debit" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                    </span>
                </div>
                <!--## Credit-->
                <div class="act_as_cell amount" style="width: 110px;">
                    <t t-set="domain"
                        t-value="[('account_id', '=', account.account_id.id),
                                  ('date', '&gt;=', account.report_id.date_from),
                                  ('date', '&lt;=', account.report_id.date_to),
                                  ('credit', '&lt;&gt;', 0)]"/>
                    <span>
                        <t t-att-style="style" t-raw="account.credit" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                    </span>
                </div>
                <!--## Ending balance-->
                <div class="act_as_cell amount" style="width: 110px;">
                    <t t-set="domain"
                           t-value="[('account_id', '=', account.account_id.id)]"/>
                    <span>
                        <t t-att-style="style" t-raw="account.final_balance" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                    </span>
                </div>
                <t t-if="foreign_currency">
                    <t t-if="account.currency_id.id">
                        <!--## currency_name-->
                        <div class="act_as_cell" style="width: 4.43%;">
                            <t t-set="domain"
                            t-value="[('account_id', '=', account.account_id.id)]"/>
                            <span t-field="account.currency_id.display_name"/>
                        </div>
                        <!--## balance_currency-->
                        <div class="act_as_cell amount" style="width: 8.86%;">
                            <t t-set="domain"
                            t-value="[('account_id', '=', account.account_id.id),
                                      ('date', '&lt;', o.date_from)]"/>
                            <span>
                                <t t-att-style="style" t-raw="account.initial_balance_foreign_currency" t-options="{'widget': 'monetary', 'display_currency': account.account_id.currency_id}"/>
                            </span>
                        </div>
                        <div class="act_as_cell amount" style="width: 8.86%;">
                            <t t-set="domain"
                               t-value="[('account_id', '=', account.account_id.id)]"/>
                            <span>
                                <t t-att-style="style" t-raw="account.final_balance_foreign_currency" t-options="{'widget': 'monetary', 'display_currency': account.account_id.currency_id}"/>
                            </span>
                        </div>
                    </t>
                    <t t-if="not account.currency_id.id">
                        <div class="act_as_cell" style="width: 4.43%;"/>
                        <div class="act_as_cell" style="width: 8.86%;"/>
                        <div class="act_as_cell" style="width: 8.86%;"/>
                    </t>
                </t>
            </div>
        </div>
    </template>

</odoo>
